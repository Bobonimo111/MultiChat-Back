<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Home</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
            crossorigin="anonymous">
        <link rel="stylesheet" th:href="@{/css/style.css}">
    </head>

    <body class="vh-100">
        <header class="h-10 py-3 ps-color1">
            <h1 class="m-0 d-flex justify-content-center">
                <span id="chat-name" class="text-white">Nome do chat</span>
            </h1>
        </header>
        <section id="chats-section" class="h-90 ps-color2">
            <div style="height: 90%;">
                <ul id="messages"
                    class="p-3
                    list-unstyled h-100 
                    overflow-auto d-flex flex-column">

                </ul>
            </div>
            <hr class="mb-2  border border-3 border-white opacity-100 ">
            <div class="h-10 text-center">
                <form action="#" method="post" class="row px-4"
                    id="message-form">
                    <div class="col-10">
                        <input placeholder="Escreva algo..."
                            class="form-control" type="text" name="message"
                            id="message-input">
                    </div>
                    <button class="col-2 btn border rounded fw-bolder bg-white"
                        type="submit">
                        >
                    </button>
                </form>
            </div>
        </section>
    </body>
    <script th:src="@{/js/jquery-3.7.1.min.js}"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>
    <script>
        const user_side = (message,date)=>{
            // Dono da conta atual 
                    ```
                    <li class="ps-color1 border border-black rounded mb-2 ms-5 ms-2">
                        <div class="text-end ms-4 me-4 my-3 text-white fs-5">
                                ${message}
                            <h6 class="m-0 pt-2 ps-2 fs-6 fw-bold">
                                ${date}
                            </h6>
                        </div>
                    </li>
                    ```
                }
        const guest_side = (message,date)=>{


            // Pessoa com quem ele conversa
            ```
                    <li
                        class="ps-color1 border border-black rounded mb-2 ms-2 me-5">
                        <div class="text-start ms-4 me-4 my-3 text-white fs-5">
                                ${message}
                            <h6 class="m-0 pt-2 ps-2 fs-6 fw-bold">
                                ${date}
                            </h6>
                        </div>
                    </li>
            ```
            }
        const definirNomeSuperior = (text)=>{
            $("#chat-name").text(text); 
        }
        //Carregar informações do banco de dados
        //guardar o id do chat
        //http://localhost:8080/application/chat?ChatId=00a8913d-182e-45a9-b2fd-58b289314b44

        let urlParams = new URLSearchParams(window.location.search);
        let chatId = urlParams.get("chatid");
         var dataSet;
        $(document).ready(function(){
            $.get(`http://localhost:8080/user/usersByChat/${chatId}`)
                .done(function(data){
                   if(data.length <= 2){
                        let text = "";
                        for(let i=0; i < data.length; i++){
                            text += `- ${data[i].username} -` 
                        }
                        definirNomeSuperior(text);
                   }
                })
        })

        
        //Registrar usuarios no stomp do chat
        
    </script>

</html>